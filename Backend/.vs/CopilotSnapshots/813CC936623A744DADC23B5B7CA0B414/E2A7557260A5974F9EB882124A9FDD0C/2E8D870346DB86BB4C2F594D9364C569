using Domain.Entities;
using Domain.Interfaces;
using Infraestructure.Data;
using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace Infraestructure.Repositorios
{
 public class PedidoRepositorio : IPedidoRepositorio
 {
 private readonly AppDbContext _context;
 public PedidoRepositorio(AppDbContext context){ _context = context; }

 public async Task<Pedido> CrearAsync(Pedido pedido)
 {
 _context.Pedidos.Add(pedido);
 await _context.SaveChangesAsync();
 return pedido;
 }

 public async Task<Pedido?> ObtenerPorIdAsync(Guid id)
 => await _context.Pedidos.Include(p=>p.Detalles).ThenInclude(d=>d.Producto).Include(p=>p.Pago).FirstOrDefaultAsync(p=>p.Id==id);

 public async Task<IEnumerable<Pedido>> ListarAsync()
 => await _context.Pedidos.Include(p=>p.Detalles).ThenInclude(d=>d.Producto).Include(p=>p.Pago).AsNoTracking().ToListAsync();

 public async Task ActualizarAsync(Pedido pedido)
 {
 _context.Pedidos.Update(pedido);
 await _context.SaveChangesAsync();
 }
 }
}
